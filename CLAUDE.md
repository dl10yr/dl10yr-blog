# CLAUDE.md

This file provides guidance to Claude Code (claude.ai/code) when working with code in this repository.

## 開発ワークフロー

### 4段階開発プロセス

**重要**: 重要な変更は必ず構造化された4段階アプローチに従う：

#### 1. 要件定義フェーズ

- `.claude_workflow/complete.md`が存在すれば参照
- 目的の明確化、現状把握、成功基準の設定
- `.claude_workflow/requirements.md`に文書化
- **必須確認**: 「要件定義フェーズが完了しました。設計フェーズに進んでよろしいですか？」

#### 2. 設計フェーズ

- **必ず**`.claude_workflow/requirements.md`を読み込んでから開始
- アプローチ検討、実施手順決定、問題点の特定
- `.claude_workflow/design.md`に文書化
- **必須確認**: 「設計フェーズが完了しました。タスク化フェーズに進んでよろしいですか？」

#### 3. タスク化フェーズ

- **必ず**`.claude_workflow/design.md`を読み込んでから開始
- タスクを実行可能な単位に分解、優先順位設定
- `.claude_workflow/tasks.md`に文書化
- **必須確認**: 「タスク化フェーズが完了しました。実行フェーズに進んでよろしいですか？」

#### 4. 実行フェーズ

- **必ず**`.claude_workflow/tasks.md`を読み込んでから開始
- タスクを順次実行、進捗を`.claude_workflow/tasks.md`に更新
- 各タスク完了時に報告

### 開発基本ルール

- **段階的進行**: フェーズを順番に実行、完了後に次へ進む
- **必須確認**: 次フェーズ移行前に承認を得る
- **白紙スタート**: 各フェーズで新規ファイル作成、前内容は引き継がない
- **エラー解決**: エラーは必ず解決してから次へ進む
- **文書化**: 各フェーズの成果物を指定ファイルに文書化
- **スコープ遵守**: 要求以外の機能を追加しない
- **単一集中**: 一度に一つのタスクに集中
- **小規模コミット**: 小さな変更を積み重ね、コミットも小単位で実行
- **フェーズ移行**: 新フェーズ開始時は前フェーズファイルを必ず読み込む
- **ルール更新**: 新しい開発ルールや重要な知見を得た場合、即座にCLAUDE.mdに追記・更新する
- **頻繁コミット**: 実装中は機能単位・コンポーネント単位でこまめにコミットする
- **進捗更新必須**: タスク完了時は必ず`.claude_workflow/tasks.md`と`doc/tasks.md`の両方を更新してコミットする
- **詳細進捗記録**: タスク完了時は実装詳細、コミットハッシュ、成果物を記録する
- **Cloudflare連携**: D1データベース、Pages、NextAuth.jsの設定を一貫して管理
- **厳格なエラー解決**: ESLintエラーとTypeScriptエラーの両方を必ず解決してからコミット
  - `npm run lint` でESLintエラーをチェック・修正
  - `npm run type-check` でTypeScriptエラーをチェック・修正
  - エラーが残っている状態でのコミットは禁止
- **ファイル集中修正**: 一つのファイルのエラーがゼロになるまで他のファイルに移らない
  - エラー数の多いファイルから優先的に修正
  - 各ファイル修正後に必ずTypeScriptとESLint両方をチェック
  - ファイル完全修正後にコミット、次ファイルへ移行
  - `any` 型の使用は厳禁、適切な型定義を必ず行う
- **未使用コード処理**: コメントアウトではなく削除または修正で対応
  - 未使用変数・関数は削除、必要なものは修正
  - 将来実装予定の場合は簡潔なコメントのみ残す
- **ファイル別完全修正**: 各ファイルのESLintエラーとTypeScriptエラーを完全にゼロにしてから次のファイルに進む
  - 一つのファイルで両方のエラーが完全に解決されるまで他のファイルの修正は行わない
  - ファイル毎に `npm run lint | grep filename` と `npx tsc --noEmit | grep filename` で確認
  - エラーゼロ確認後に次のファイルに移行する
- **knip検査必須**: 各タスク終了時に `nr knip` で不要なコード検査・削除を実行
  - 未使用ファイル、不要な依存関係、未使用exports/typesを特定
  - 検出された不要なコードは即座に削除
  - 将来必要になる可能性がある型定義は例外的に保持可
  - knip実行後にTypeScript・ESLintエラーを再確認し完全解決
- **ni/nrコマンド使用**: パッケージ管理は`ni`、スクリプト実行は`nr`コマンドを使用
  - `npm install` → `ni` に置換
  - `npm run script` → `nr script` に置換
  - 高速で統一された開発体験を提供

### Git戦略・コミット方針

- **タスクブランチ**: 各タスク（T001, T002...）ごとに専用ブランチを作成
  - ブランチ名パターン: `feature/t001-task-description`
  - 例: `feature/t001-nextjs-setup`, `feature/t002-nextauth-config`
- **ワークフロー文書コミット**: 各フェーズのワークフロー文書を段階的にコミット
- **細かいコミット**: 機能単位での小さなコミットを推奨
- **マージ戦略**: タスク完了後にmainブランチへマージ
- **進捗追跡**: doc/tasks.mdの進捗状況を随時更新
